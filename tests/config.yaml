doctrine:
    dbal:
        default_connection: default
        connections:
            default:
                url: 'sqlite:///:memory:'
                profiling: true
                charset: UTF8
        types:
            carbon_immutable: Carbon\Doctrine\CarbonImmutableType
    orm:
        default_entity_manager: default
        auto_generate_proxy_classes: true
        naming_strategy: doctrine.orm.naming_strategy.underscore_number_aware
        auto_mapping: true
        mappings:
           LingodaDomainEventsBundle:
                type: annotation
                prefix: Lingoda\DomainEventsBundle\Infra\Doctrine\Entity\
                dir: 'Infra/Doctrine/Entity'

framework:
    messenger:
        default_bus: messenger.bus.default

        buses:
            messenger.bus.default:
                default_middleware: allow_no_handlers

    session:
        handler_id: null
        storage_factory_id: session.storage.factory.native

services:
    dunglas_doctrine_json_odm.normalizer.array:
        class: Symfony\Component\Serializer\Normalizer\ArrayDenormalizer
        public: true

    dunglas_doctrine_json_odm.normalizer.carbon:
        class: Lingoda\DomainEventsBundle\Infra\Serializer\CarbonNormalizer
        public: true

    dunglas_doctrine_json_odm.serializer:
        autoconfigure: false
        class: Dunglas\DoctrineJsonOdm\Serializer
        arguments:
            $normalizers:
                - "@serializer.normalizer.uid"
                - "@dunglas_doctrine_json_odm.normalizer.array"
                - "@dunglas_doctrine_json_odm.normalizer.carbon"
                - "@dunglas_doctrine_json_odm.normalizer.datetime"
                - "@dunglas_doctrine_json_odm.normalizer.object"
            $encoders:
                - "@serializer.encoder.json"
        public: true

    test.lingoda_domain_events.domain_event_dispatcher_service:
        alias: lingoda_domain_events.domain_event_dispatcher_service
        public: true

    test.lingoda_domain_events.event_subscriber.publisher:
        alias: lingoda_domain_events.event_subscriber.publisher
        public: true

    test.lingoda_domain_events.event_subscriber.persister:
        alias: lingoda_domain_events.event_subscriber.persister
        public: true

    test.lingoda_domain_events.lockable_event_publisher:
        alias: lingoda_domain_events.lockable_event_publisher
        public: true

    test.lingoda_domain_events.messenger.transport.outbox.factory:
        alias: lingoda_domain_events.messenger.transport.outbox.factory
        public: true

    test.lingoda_domain_events.outbox_message_handler:
        alias: lingoda_domain_events.outbox_message_handler
        public: true

    test.lingoda_domain_events.repository.outbox_store_doctrine:
        alias: lingoda_domain_events.repository.outbox_store_doctrine
        public: true

    test.lingoda_domain_events.repository.outbox_store:
        alias: Lingoda\DomainEventsBundle\Domain\Model\OutboxStore
        public: true
